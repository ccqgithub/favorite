# 对[主流git工作流对比](http://ustory.lofter.com/post/33be15_b506417)的理解。

> 仔细看了下，的确是一种解决方案，不过觉得有点问题，可能你对gitflow的理解有些偏差。

## 标准gitflow工作流：

[参考文章](http://nvie.com/posts/a-successful-git-branching-model/)。
![git flow](http://nvie.com/img/git-model@2x.png)

- master: 分支的代码永远都是处于能对外发布的状态。
- develop: 主开发分支，上面的代码都是为*下一个版本*的发布而存在的，凡是确定下一个版本要发布的功能应该直接在这分支上开发，没有必要开分支。
develop分支并不需要保证固定时间可用，只是需要对版本发布有很好的规划（比如下一个版本几月几号发，上什么功能）。develop上的代码始终是下一个可以发布的代码，下一个版本不要发布的feature不能合并到develop，等下一个版本的release分支建立之后，才可以合并到下下个版本。
- feature: 分支并不是按功能模块划分，只有不适合在*下一个版本*发布的内容才建立feature分支（是有可能完全抛弃的分支）。如果两个完全互不交叉的功能模块，应该是开两个版本库，而不是开两个feature。
[feature分支一旦合并到develop即删除, 新的功能另开feature]。
- release: 分支只做发布版本号，作者标签等管理，或者小bug修复，不做新功能开发，最后也会合并到develop，保证develop的完整性。
- hotfix: 紧急bug修复。


## 上面提出的新工作流存在的问题：

- *将feature作为互不干扰的功能模块进行划分*。更好的方法是独立为各种的版本库，而不是开分支。feature的定义，不是独立的模块，而是不适合接下来版本发布的功能。
- *长期并行存在多个feature分支*。实际上，分支存在时间越长，最后合并的风险往往越大。分支自己的准确性，并不能保证合并后整个版本库的准确性，时间越长越明显。
- *master分支的来源不一*。每个分支独自发布，并不能保证合并后master分支的准确性。
- *没有一个主开发分支*。意味着版本控制不清晰，还有，线上的非紧急bug或小调整，莫非要开一个feature或者hotfix？
- *发布时间不明确*。各个分支交叉测试，却又独立发布！测试的过程中各个分支都可以向develop分支合并，如何确定每个分支什么时候是可以发布的？（事实上每一次合并都有对之前测试结果的影响）有可能a分支的正确性其实是暗地里依赖于b分支代码而存在的，也有可能a分支发布后，b分支一合并，a分支就会产生bug。
- *合并繁琐*。从master分支拉出release分支，产生的bug算谁的？bug修复后是否合并到每一个feature？如果不合并，怎么能保证你的修改和feature合并不会产生新的问题？如果合并，谁来合并？
- hotfix和release实际上存在同样的问题，最后是否合并到任何一个feature？如果不合并，怎么能保证你的修改和feature合并不会产生新的问题？如果合并，操作麻烦，逻辑混乱。

## 提到的疑虑

- 周期性发布？a开发一个功能A，这周一发布，b开发一个功能B，下周一发布。是两个不同版本的功能都同时随便合并到develop测试【实际上测试同时测试两个版本的功能是不合理的】？两个功能的代码是混合测试的，可周一只发布了A的代码，B代码没发布，风险很大。更好的做法是，这周一之前B功能自测，等周一release分支建立后，B功能再合并到develop准备下周一版本的测试。
- 紧急上线？那应该是版本规划没做好吧？确实有特殊情况的紧急发布，应该都属于`hotfix`的范畴了吧。
